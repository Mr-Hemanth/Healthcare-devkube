Started by user Hemanth Reddy
Obtained Jenkinsfile from git https://github.com/Mr-Hemanth/Healthcare-devkube.git
[Pipeline] Start of Pipeline
[Pipeline] node
Running on Jenkins in /var/lib/jenkins/workspace/healthcare-devkube-pipeline
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Declarative: Checkout SCM)
[Pipeline] checkout
Selected Git installation does not exist. Using Default
The recommended git tool is: NONE
using credential github-pat
 > git rev-parse --resolve-git-dir /var/lib/jenkins/workspace/healthcare-devkube-pipeline/.git # timeout=10
Fetching changes from the remote Git repository
 > git config remote.origin.url https://github.com/Mr-Hemanth/Healthcare-devkube.git # timeout=10
Fetching upstream changes from https://github.com/Mr-Hemanth/Healthcare-devkube.git
 > git --version # timeout=10
 > git --version # 'git version 2.34.1'
using GIT_ASKPASS to set credentials GitHub Personal Access Token
 > git fetch --tags --force --progress -- https://github.com/Mr-Hemanth/Healthcare-devkube.git +refs/heads/*:refs/remotes/origin/* # timeout=10
 > git rev-parse refs/remotes/origin/main^{commit} # timeout=10
Checking out Revision fa1095562a3b28280adb12d25a9374665a5d7a39 (refs/remotes/origin/main)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f fa1095562a3b28280adb12d25a9374665a5d7a39 # timeout=10
Commit message: "made changes in k8, jenkings"
 > git rev-list --no-walk af46f793e29690a541333490be2ffc216383d151 # timeout=10
[Pipeline] }
[Pipeline] // stage
[Pipeline] withEnv
[Pipeline] {
[Pipeline] withCredentials
Masking supported pattern matches of $SERVICE_ACCOUNT_KEY
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Checkout)
[Pipeline] echo
Checking out source code...
[Pipeline] checkout
Selected Git installation does not exist. Using Default
The recommended git tool is: NONE
using credential github-pat
 > git rev-parse --resolve-git-dir /var/lib/jenkins/workspace/healthcare-devkube-pipeline/.git # timeout=10
Fetching changes from the remote Git repository
 > git config remote.origin.url https://github.com/Mr-Hemanth/Healthcare-devkube.git # timeout=10
Fetching upstream changes from https://github.com/Mr-Hemanth/Healthcare-devkube.git
 > git --version # timeout=10
 > git --version # 'git version 2.34.1'
using GIT_ASKPASS to set credentials GitHub Personal Access Token
 > git fetch --tags --force --progress -- https://github.com/Mr-Hemanth/Healthcare-devkube.git +refs/heads/*:refs/remotes/origin/* # timeout=10
 > git rev-parse refs/remotes/origin/main^{commit} # timeout=10
Checking out Revision fa1095562a3b28280adb12d25a9374665a5d7a39 (refs/remotes/origin/main)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f fa1095562a3b28280adb12d25a9374665a5d7a39 # timeout=10
Commit message: "made changes in k8, jenkings"
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Verify Prerequisites)
[Pipeline] script
[Pipeline] {
[Pipeline] echo
Verifying all required tools are properly installed...
[Pipeline] sh
+ echo === Environment Verification ===
=== Environment Verification ===
+ whoami
+ echo Current user: jenkins
Current user: jenkins
+ echo Current PATH: /usr/local/bin:/snap/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
Current PATH: /usr/local/bin:/snap/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
+ pwd
+ echo Working directory: /var/lib/jenkins/workspace/healthcare-devkube-pipeline
Working directory: /var/lib/jenkins/workspace/healthcare-devkube-pipeline
+ echo === Tool Verification ===
=== Tool Verification ===
+ node --version
+ echo Node.js: v18.20.8
Node.js: v18.20.8
+ npm --version
+ echo npm: 10.8.2
npm: 10.8.2
+ docker --version
+ echo Docker: Docker version 27.5.1, build 27.5.1-0ubuntu3~22.04.2
Docker: Docker version 27.5.1, build 27.5.1-0ubuntu3~22.04.2
+ [ -f /usr/local/bin/gcloud ]
+ /usr/local/bin/gcloud --version
+ head -1
Updates are available for some Google Cloud CLI components.  To install them,
please run:
  $ gcloud components update
+ echo gcloud: Google Cloud SDK 456.0.0
gcloud: Google Cloud SDK 456.0.0
+ [ -f /usr/local/bin/kubectl ]
+ /usr/local/bin/kubectl version --client
+ head -1
+ echo kubectl: Client Version: v1.34.1
kubectl: Client Version: v1.34.1
+ [ -f /usr/local/bin/gke-gcloud-auth-plugin ]
+ /usr/local/bin/gke-gcloud-auth-plugin --version
+ echo gke-auth-plugin: Kubernetes v1.28.0-alpha+918af8f95e54adc06c7f33df3ab7c68bd24fc278
gke-auth-plugin: Kubernetes v1.28.0-alpha+918af8f95e54adc06c7f33df3ab7c68bd24fc278
+ echo ✅ All prerequisites verified successfully!
✅ All prerequisites verified successfully!
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Setup GCP Authentication)
[Pipeline] script
[Pipeline] {
[Pipeline] echo
Setting up GCP authentication...
[Pipeline] sh
+ export USE_GKE_GCLOUD_AUTH_PLUGIN=True
+ echo Authenticating with service account...
Authenticating with service account...
+ /usr/local/bin/gcloud auth activate-service-account --key-file=****
Activated service account credentials for: [jenkins-sa@hc-3-monitoring.iam.gserviceaccount.com]
+ echo Setting project...
Setting project...
+ /usr/local/bin/gcloud config set project hc-3-monitoring
Updated property [core/project].
+ echo Configuring Docker authentication...
Configuring Docker authentication...
+ /usr/local/bin/gcloud auth configure-docker asia-south1-docker.pkg.dev --quiet
WARNING: Your config file at [/var/lib/jenkins/.docker/config.json] contains these credential helper entries:

{
  "credHelpers": {
    "asia-south1-docker.pkg.dev": "gcloud"
  }
}
Adding credentials for: asia-south1-docker.pkg.dev
gcloud credential helpers already registered correctly.
+ echo ✅ GCP authentication setup complete
✅ GCP authentication setup complete
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Test Backend)
[Pipeline] dir
Running in /var/lib/jenkins/workspace/healthcare-devkube-pipeline/server
[Pipeline] {
[Pipeline] script
[Pipeline] {
[Pipeline] echo
Testing Backend Application...
[Pipeline] sh
+ echo Installing backend dependencies...
Installing backend dependencies...
+ npm install

up to date, audited 112 packages in 2s

16 packages are looking for funding
  run `npm fund` for details

5 vulnerabilities (3 high, 2 critical)

To address all issues, run:
  npm audit fix

Run `npm audit` for details.
+ echo Running syntax check...
Running syntax check...
+ node -c server.js
+ echo ✅ Backend tests passed
✅ Backend tests passed
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // dir
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Test Frontend)
[Pipeline] dir
Running in /var/lib/jenkins/workspace/healthcare-devkube-pipeline/client
[Pipeline] {
[Pipeline] script
[Pipeline] {
[Pipeline] echo
Testing Frontend Application...
[Pipeline] sh
+ echo Installing frontend dependencies...
Installing frontend dependencies...
+ npm install

up to date, audited 1509 packages in 8s

271 packages are looking for funding
  run `npm fund` for details

22 vulnerabilities (3 low, 7 moderate, 10 high, 2 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.
+ echo Running tests...
Running tests...
+ CI=true npm test -- --coverage --watchAll=false

> client@0.1.0 test
> react-scripts test --coverage --watchAll=false

  console.error
    Warning: `ReactDOMTestUtils.act` is deprecated in favor of `React.act`. Import `act` from `react` instead of `react-dom/test-utils`. See https://react.dev/warnings/react-dom-test-utils for more info.

    [0m [90m 3 |[39m
     [90m 4 |[39m test([32m'renders healthcare welcome message'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 5 |[39m   render([33m<[39m[33mApp[39m [33m/[39m[33m>[39m)[33m;[39m
     [90m   |[39m         [31m[1m^[22m[39m
     [90m 6 |[39m   [36mconst[39m welcomeElement [33m=[39m screen[33m.[39mgetByText([35m/Welcome to Healthcare Management System/i[39m)[33m;[39m
     [90m 7 |[39m   expect(welcomeElement)[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m 8 |[39m })[33m;[39m[0m

      at printWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:71:30)
      at error (node_modules/react-dom/cjs/react-dom-test-utils.development.js:45:7)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1736:7)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:159:26)
      at render (node_modules/@testing-library/react/dist/pure.js:246:10)
      at Object.<anonymous> (src/App.test.js:5:9)
      at TestScheduler.scheduleTests (node_modules/@jest/core/build/TestScheduler.js:333:13)
      at runJest (node_modules/@jest/core/build/runJest.js:404:19)
      at _run10000 (node_modules/@jest/core/build/cli/index.js:320:7)
      at runCLI (node_modules/@jest/core/build/cli/index.js:173:3)

PASS src/App.test.js
  ✓ renders healthcare welcome message (150 ms)

----------------------------|---------|----------|---------|---------|-------------------------------
File                        | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s             
----------------------------|---------|----------|---------|---------|-------------------------------
All files                   |   36.42 |      4.6 |    8.98 |   36.42 |                               
 src                        |    9.09 |        0 |   33.33 |    9.09 |                               
  App.js                    |     100 |      100 |     100 |     100 |                               
  index.js                  |       0 |      100 |     100 |       0 | 6-7                           
  reportWebVitals.js        |       0 |        0 |       0 |       0 | 1-8                           
 src/components             |    35.5 |     0.78 |     4.1 |    35.5 |                               
  About.js                  |   16.66 |      100 |       0 |   16.66 | 4-33                          
  AdminPage.js              |       5 |        0 |       0 |       5 | 5-111                         
  AppointmentScheduling.js  |      50 |        0 |       0 |      50 | 6-147                         
  Billing.js                |   48.78 |        0 |       0 |   48.78 | 6-219                         
  Footer.js                 |     100 |      100 |     100 |     100 |                               
  Home.js                   |      10 |      100 |       0 |      10 | 6-217                         
  Login.js                  |     2.5 |        0 |       0 |     2.5 | 8-146                         
  MedicalRecord.js          |      50 |        0 |       0 |      50 | 6-166                         
  Navbar.js                 |      50 |       25 |    8.33 |      50 | 10-11,75-119                  
  ProtectedRoute.js         |    12.5 |        0 |       0 |    12.5 | 6-50                          
  Signup.js                 |   17.64 |        0 |       0 |   17.64 | 7-165                         
  UnauthorizedAccess.js     |       0 |      100 |       0 |       0 | 4-5                           
  Welcome.js                |     100 |      100 |     100 |     100 |                               
 src/config                 |   40.74 |       25 |   16.66 |   40.74 |                               
  api.js                    |   40.74 |       25 |   16.66 |   40.74 | 17-20,25,31-36,67,82-87,94-99 
 src/context                |   62.06 |       50 |      60 |   62.06 |                               
  AuthContext.js            |   62.06 |       50 |      60 |   62.06 | 8,24-25,31-34,38-41           
 src/hooks                  |    12.5 |        0 |       0 |    12.5 |                               
  useProtectedNavigation.js |    12.5 |        0 |       0 |    12.5 | 5-16                          
----------------------------|---------|----------|---------|---------|-------------------------------
Test Suites: 1 passed, 1 total
Tests:       1 passed, 1 total
Snapshots:   0 total
Time:        4.656 s, estimated 5 s
Ran all test suites.
+ echo ✅ Frontend tests passed
✅ Frontend tests passed
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // dir
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Build Docker Images)
[Pipeline] parallel
[Pipeline] { (Branch: Build Backend Image)
[Pipeline] { (Branch: Build Frontend Image)
[Pipeline] stage
[Pipeline] { (Build Backend Image)
[Pipeline] stage
[Pipeline] { (Build Frontend Image)
[Pipeline] dir
Running in /var/lib/jenkins/workspace/healthcare-devkube-pipeline/server
[Pipeline] {
[Pipeline] dir
Running in /var/lib/jenkins/workspace/healthcare-devkube-pipeline/client
[Pipeline] {
[Pipeline] script
[Pipeline] {
[Pipeline] script
[Pipeline] {
[Pipeline] echo
Building Backend Docker Image...
[Pipeline] sh
[Pipeline] echo
Building Frontend Docker Image...
[Pipeline] sh
+ echo Building: asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-backend:25
Building: asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-backend:25
+ docker build -t asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-backend:25 .
DEPRECATED: The legacy builder is deprecated and will be removed in a future release.
            Install the buildx component to build images with BuildKit:
            https://docs.docker.com/go/buildx/

+ echo Building: asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-frontend:25
Building: asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-frontend:25
+ echo Setting API base URL for K8s service communication...
Setting API base URL for K8s service communication...
+ docker build --build-arg REACT_APP_API_BASE_URL=http://healthcare-backend-service:5002 -t asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-frontend:25 .
DEPRECATED: The legacy builder is deprecated and will be removed in a future release.
            Install the buildx component to build images with BuildKit:
            https://docs.docker.com/go/buildx/

Sending build context to Docker daemon  1.674MB

Step 1/15 : FROM node:18-alpine
 ---> ee77c6cd7c18
Step 2/15 : WORKDIR /usr/src/app
 ---> Using cache
 ---> d5b6982b3eec
Step 3/15 : COPY package*.json ./
 ---> Using cache
 ---> 44786eaadbaf
Step 4/15 : RUN npm ci && npm cache clean --force
 ---> Using cache
 ---> 06d2fe61e4f4
Step 5/15 : COPY . .
 ---> 5f377f5a0add
Step 6/15 : ARG REACT_APP_API_BASE_URL
 ---> Running in 5c06019b8790
 ---> Removed intermediate container 5c06019b8790
 ---> 1607383b48b3
Step 7/15 : ENV REACT_APP_API_BASE_URL=$REACT_APP_API_BASE_URL
 ---> Running in ba39aea9c52b
 ---> Removed intermediate container ba39aea9c52b
 ---> 646c319c209f
Step 8/15 : RUN npm run build
Sending build context to Docker daemon  20.92MB

Step 1/10 : FROM node:18-alpine
 ---> ee77c6cd7c18
Step 2/10 : WORKDIR /app
 ---> Using cache
 ---> b114ec080dd9
Step 3/10 : COPY package*.json ./
 ---> Using cache
 ---> b1bf93e01a98
Step 4/10 : RUN npm ci --only=production && npm cache clean --force
 ---> Using cache
 ---> 5b8c6256d7af
Step 5/10 : RUN addgroup -g 1001 -S nodejs
 ---> Using cache
 ---> e04cbc3e6f71
Step 6/10 : RUN adduser -S nodejs -u 1001
 ---> Using cache
 ---> 78135c2adf68
Step 7/10 : COPY --chown=nodejs:nodejs . .
 ---> Using cache
 ---> f8f1a9674f36
Step 8/10 : USER nodejs
 ---> Using cache
 ---> be2e12d695ff
Step 9/10 : EXPOSE 5002
 ---> Using cache
 ---> b59bc7e26e05
Step 10/10 : CMD ["node", "server.js"]
 ---> Using cache
 ---> 589a8208dee7
Successfully built 589a8208dee7
 ---> Running in 18fd2a17475a
Successfully tagged asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-backend:25
+ docker tag asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-backend:25 asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-backend:latest
+ echo ✅ Backend image built successfully
✅ Backend image built successfully
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // dir
[Pipeline] }
[Pipeline] // stage
[Pipeline] }

> client@0.1.0 build
> react-scripts build

Creating an optimized production build...
[91mBrowserslist: browsers data (caniuse-lite) is 11 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
[0m[91m[0;33mOne of your dependencies, babel-preset-react-app, is importing the
"@babel/plugin-proposal-private-property-in-object" package without
declaring it in its dependencies. This is currently working because
"@babel/plugin-proposal-private-property-in-object" is already in your
node_modules folder for unrelated reasons, but it [1mmay break at any time[0;33m.

babel-preset-react-app is part of the create-react-app project, [1mwhich
is not maintianed anymore[0;33m. It is thus unlikely that this bug will
ever be fixed. Add "@babel/plugin-proposal-private-property-in-object" to
your devDependencies to work around this error. This will make this message
go away.[0m
  
[0m[91mBrowserslist: browsers data (caniuse-lite) is 11 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
[0mCompiled with warnings.

[eslint] 
src/config/api.js
  Line 103:1:  Assign object to a variable before exporting as module default  import/no-anonymous-default-export

Search for the keywords to learn more about each warning.
To ignore, add // eslint-disable-next-line to the line before.

File sizes after gzip:

  134.7 kB  build/static/js/main.9ed0f12c.js
  1.09 kB   build/static/css/main.3ebbdcc8.css

The project was built assuming it is hosted at /.
You can control this with the homepage field in your package.json.

The build folder is ready to be deployed.
You may serve it with a static server:

  npm install -g serve
  serve -s build

Find out more about deployment here:

  https://cra.link/deployment

 ---> Removed intermediate container 18fd2a17475a
 ---> 80ff64dd2c51
Step 9/15 : RUN npm install -g serve
 ---> Running in 11c96bd43290

added 86 packages in 8s

25 packages are looking for funding
  run `npm fund` for details
 ---> Removed intermediate container 11c96bd43290
 ---> fe62d6dd4d68
Step 10/15 : RUN addgroup -g 1001 -S nodejs
 ---> Running in aaf0e6e43be2
 ---> Removed intermediate container aaf0e6e43be2
 ---> c1121236228e
Step 11/15 : RUN adduser -S nextjs -u 1001
 ---> Running in 1542281fd34d
 ---> Removed intermediate container 1542281fd34d
 ---> 437af824b5ff
Step 12/15 : RUN chown -R nextjs:nodejs /usr/src/app/build
 ---> Running in 24d7821507c3
 ---> Removed intermediate container 24d7821507c3
 ---> c559dfa78400
Step 13/15 : USER nextjs
 ---> Running in 9d3c9f06cc2f
 ---> Removed intermediate container 9d3c9f06cc2f
 ---> b56add98c0ff
Step 14/15 : EXPOSE 3000
 ---> Running in be1e9214f8b2
 ---> Removed intermediate container be1e9214f8b2
 ---> dd98adbec45f
Step 15/15 : CMD ["serve", "-s", "build", "-l", "3000"]
 ---> Running in 05ba71fcae6f
 ---> Removed intermediate container 05ba71fcae6f
 ---> 5b67fa4412b6
Successfully built 5b67fa4412b6
Successfully tagged asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-frontend:25
+ docker tag asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-frontend:25 asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-frontend:latest
+ echo ✅ Frontend image built successfully with Kubernetes API URL
✅ Frontend image built successfully with Kubernetes API URL
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // dir
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // parallel
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Push Images to Artifact Registry)
[Pipeline] parallel
[Pipeline] { (Branch: Push Backend Image)
[Pipeline] { (Branch: Push Frontend Image)
[Pipeline] stage
[Pipeline] { (Push Backend Image)
[Pipeline] stage
[Pipeline] { (Push Frontend Image)
[Pipeline] script
[Pipeline] {
[Pipeline] script
[Pipeline] {
[Pipeline] echo
Pushing Backend Images...
[Pipeline] sh
[Pipeline] echo
Pushing Frontend Images...
[Pipeline] sh
+ docker push asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-backend:25
+ docker push asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-frontend:25
The push refers to repository [asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-backend]
6cc733efde0a: Preparing
66ef3b520668: Preparing
fc57048cf79c: Preparing
698bcc6679dc: Preparing
1d8dfb065721: Preparing
b34c57d81995: Preparing
82140d9a70a7: Preparing
f3b40b0cdb1c: Preparing
0b1f26057bd0: Preparing
08000c18d16d: Preparing
b34c57d81995: Waiting
82140d9a70a7: Waiting
f3b40b0cdb1c: Waiting
0b1f26057bd0: Waiting
08000c18d16d: Waiting
66ef3b520668: Layer already exists
6cc733efde0a: Layer already exists
698bcc6679dc: Layer already exists
fc57048cf79c: Layer already exists
1d8dfb065721: Layer already exists
b34c57d81995: Layer already exists
82140d9a70a7: Layer already exists
0b1f26057bd0: Layer already exists
f3b40b0cdb1c: Layer already exists
08000c18d16d: Layer already exists
The push refers to repository [asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-frontend]
af826a0b67a5: Preparing
f0c8798bb808: Preparing
ee96eadc5674: Preparing
dbc3807ec479: Preparing
f08cee752098: Preparing
35525be5ec79: Preparing
835be13f7842: Preparing
3ba7933f0c87: Preparing
b24b8265f24c: Preparing
82140d9a70a7: Preparing
f3b40b0cdb1c: Preparing
0b1f26057bd0: Preparing
08000c18d16d: Preparing
f0c8798bb808: Waiting
ee96eadc5674: Waiting
dbc3807ec479: Waiting
af826a0b67a5: Waiting
f08cee752098: Waiting
35525be5ec79: Waiting
835be13f7842: Waiting
82140d9a70a7: Waiting
3ba7933f0c87: Waiting
f3b40b0cdb1c: Waiting
b24b8265f24c: Waiting
08000c18d16d: Waiting
0b1f26057bd0: Waiting
25: digest: sha256:36d5f76be2281064397620cb46ce2607185169c1b6363569a795da8ef03431ee size: 2409
+ docker push asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-backend:latest
f0c8798bb808: Pushed
ee96eadc5674: Pushed
835be13f7842: Layer already exists
af826a0b67a5: Pushed
3ba7933f0c87: Layer already exists
b24b8265f24c: Layer already exists
f3b40b0cdb1c: Layer already exists
82140d9a70a7: Layer already exists
0b1f26057bd0: Layer already exists
08000c18d16d: Layer already exists
35525be5ec79: Pushed
f08cee752098: Pushed
dbc3807ec479: Pushed
The push refers to repository [asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-backend]
6cc733efde0a: Preparing
66ef3b520668: Preparing
fc57048cf79c: Preparing
698bcc6679dc: Preparing
1d8dfb065721: Preparing
b34c57d81995: Preparing
82140d9a70a7: Preparing
f3b40b0cdb1c: Preparing
0b1f26057bd0: Preparing
08000c18d16d: Preparing
b34c57d81995: Waiting
82140d9a70a7: Waiting
f3b40b0cdb1c: Waiting
0b1f26057bd0: Waiting
08000c18d16d: Waiting
6cc733efde0a: Layer already exists
698bcc6679dc: Layer already exists
1d8dfb065721: Layer already exists
fc57048cf79c: Layer already exists
66ef3b520668: Layer already exists
f3b40b0cdb1c: Layer already exists
b34c57d81995: Layer already exists
0b1f26057bd0: Layer already exists
82140d9a70a7: Layer already exists
08000c18d16d: Layer already exists
25: digest: sha256:b4de559fee89aeae66a7d3e9683918e1483d4b532fb55ff5251005804e145a60 size: 3043
+ docker push asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-frontend:latest
latest: digest: sha256:36d5f76be2281064397620cb46ce2607185169c1b6363569a795da8ef03431ee size: 2409
+ echo ✅ Backend images pushed
✅ Backend images pushed
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
The push refers to repository [asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-frontend]
af826a0b67a5: Preparing
f0c8798bb808: Preparing
ee96eadc5674: Preparing
dbc3807ec479: Preparing
f08cee752098: Preparing
35525be5ec79: Preparing
835be13f7842: Preparing
3ba7933f0c87: Preparing
b24b8265f24c: Preparing
82140d9a70a7: Preparing
f3b40b0cdb1c: Preparing
0b1f26057bd0: Preparing
08000c18d16d: Preparing
35525be5ec79: Waiting
835be13f7842: Waiting
3ba7933f0c87: Waiting
82140d9a70a7: Waiting
b24b8265f24c: Waiting
f3b40b0cdb1c: Waiting
0b1f26057bd0: Waiting
08000c18d16d: Waiting
af826a0b67a5: Layer already exists
ee96eadc5674: Layer already exists
dbc3807ec479: Layer already exists
f0c8798bb808: Layer already exists
f08cee752098: Layer already exists
35525be5ec79: Layer already exists
b24b8265f24c: Layer already exists
835be13f7842: Layer already exists
3ba7933f0c87: Layer already exists
82140d9a70a7: Layer already exists
f3b40b0cdb1c: Layer already exists
0b1f26057bd0: Layer already exists
08000c18d16d: Layer already exists
latest: digest: sha256:b4de559fee89aeae66a7d3e9683918e1483d4b532fb55ff5251005804e145a60 size: 3043
+ echo ✅ Frontend images pushed
✅ Frontend images pushed
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // parallel
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Deploy to GKE)
[Pipeline] script
[Pipeline] {
[Pipeline] echo
Deploying to Google Kubernetes Engine...
[Pipeline] sh
+ export USE_GKE_GCLOUD_AUTH_PLUGIN=True
+ echo Re-authenticating for cluster access...
Re-authenticating for cluster access...
+ /usr/local/bin/gcloud auth activate-service-account --key-file=****
Activated service account credentials for: [jenkins-sa@hc-3-monitoring.iam.gserviceaccount.com]
+ /usr/local/bin/gcloud config set project hc-3-monitoring
Updated property [core/project].
+ echo Getting cluster credentials...
Getting cluster credentials...
+ /usr/local/bin/gcloud container clusters get-credentials healthcare3-cluster --location=asia-south1
Fetching cluster endpoint and auth data.
kubeconfig entry generated for healthcare3-cluster.
+ echo Testing cluster connection...
Testing cluster connection...
+ /usr/local/bin/kubectl cluster-info --request-timeout=10s
Kubernetes control plane is running at https://34.14.209.19
GLBCDefaultBackend is running at https://34.14.209.19/api/v1/namespaces/kube-system/services/default-http-backend:http/proxy
KubeDNS is running at https://34.14.209.19/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
Metrics-server is running at https://34.14.209.19/api/v1/namespaces/kube-system/services/https:metrics-server:/proxy

To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.
+ echo Deploying application with corrected configurations...
Deploying application with corrected configurations...
+ /usr/local/bin/kubectl apply -f k8s/namespace.yaml
namespace/healthcare-app unchanged
+ /usr/local/bin/kubectl apply -f k8s/configmap.yaml
configmap/healthcare-config configured
secret/healthcare-secrets unchanged
+ echo Option 1: Deploy with local MongoDB (full 3-tier)
Option 1: Deploy with local MongoDB (full 3-tier)
+ /usr/local/bin/kubectl apply -f k8s/database-deployment.yaml
deployment.apps/healthcare-mongodb unchanged
service/healthcare-mongodb-service unchanged
persistentvolumeclaim/mongodb-data-pvc unchanged
persistentvolumeclaim/mongodb-config-pvc unchanged
+ /usr/local/bin/kubectl apply -f k8s/backend-deployment.yaml
deployment.apps/healthcare-backend configured
service/healthcare-backend-service configured
+ /usr/local/bin/kubectl apply -f k8s/frontend-deployment.yaml
deployment.apps/healthcare-frontend configured
service/healthcare-frontend-service configured
+ echo Optional: Deploy monitoring stack
Optional: Deploy monitoring stack
+ /usr/local/bin/kubectl apply -f k8s/monitoring-prometheus.yaml
configmap/prometheus-config unchanged
deployment.apps/prometheus unchanged
service/prometheus-service unchanged
persistentvolumeclaim/prometheus-data-pvc unchanged
serviceaccount/prometheus-service-account unchanged
clusterrole.rbac.authorization.k8s.io/prometheus-cluster-role unchanged
clusterrolebinding.rbac.authorization.k8s.io/prometheus-cluster-role-binding unchanged
+ /usr/local/bin/kubectl apply -f k8s/monitoring-grafana.yaml
configmap/grafana-config unchanged
deployment.apps/grafana unchanged
service/grafana-service unchanged
persistentvolumeclaim/grafana-data-pvc unchanged
+ echo Optional: Deploy ingress if available
Optional: Deploy ingress if available
+ /usr/local/bin/kubectl apply -f k8s/ingress.yaml
ingress.networking.k8s.io/healthcare-ingress unchanged
+ echo Waiting for deployments...
Waiting for deployments...
+ /usr/local/bin/kubectl wait --for=condition=available deployment/healthcare-mongodb -n healthcare-app --timeout=300s
deployment.apps/healthcare-mongodb condition met
+ /usr/local/bin/kubectl wait --for=condition=available deployment/prometheus -n healthcare-app --timeout=300s
deployment.apps/prometheus condition met
+ /usr/local/bin/kubectl wait --for=condition=available deployment/grafana -n healthcare-app --timeout=300s
deployment.apps/grafana condition met
+ echo Restarting application deployments...
Restarting application deployments...
+ /usr/local/bin/kubectl rollout restart deployment/healthcare-backend -n healthcare-app
deployment.apps/healthcare-backend restarted
+ /usr/local/bin/kubectl rollout restart deployment/healthcare-frontend -n healthcare-app
deployment.apps/healthcare-frontend restarted
+ echo Waiting for application deployments...
Waiting for application deployments...
+ /usr/local/bin/kubectl wait --for=condition=available deployment/healthcare-backend -n healthcare-app --timeout=300s
deployment.apps/healthcare-backend condition met
+ /usr/local/bin/kubectl wait --for=condition=available deployment/healthcare-frontend -n healthcare-app --timeout=300s
deployment.apps/healthcare-frontend condition met
+ echo ✅ Deployment completed!
✅ Deployment completed!
+ /usr/local/bin/kubectl get all -n healthcare-app
NAME                                       READY   STATUS             RESTARTS         AGE
pod/grafana-7d8687f94b-bkq58               1/1     Running            0                14h
pod/healthcare-backend-7f54f89c96-2xphj    1/1     Running            0                3h
pod/healthcare-backend-7f54f89c96-cqfgq    1/1     Running            0                3h57m
pod/healthcare-backend-84cb878467-jv47v    0/1     Pending            0                1s
pod/healthcare-frontend-654d97f9db-lpgzm   0/1     Terminating        0                5s
pod/healthcare-frontend-76775dc848-f82dd   1/1     Running            0                7h47m
pod/healthcare-frontend-76775dc848-jtqrj   1/1     Running            0                3h
pod/healthcare-mongodb-7dbb88f5b-thr5l     1/1     Running            0                11h
pod/prometheus-6ddcd97d89-h9qwh            0/1     CrashLoopBackOff   51 (2m52s ago)   3h57m
pod/prometheus-7bbfb5596c-9wzzr            1/1     Running            0                14h

NAME                                  TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
service/grafana-service               NodePort       34.118.226.7     <none>        3000:30081/TCP   15h
service/healthcare-backend-service    ClusterIP      34.118.231.138   <none>        5002/TCP         15h
service/healthcare-frontend-service   LoadBalancer   34.118.228.162   <pending>     80:30836/TCP     15h
service/healthcare-mongodb-service    ClusterIP      34.118.236.5     <none>        27017/TCP        15h
service/prometheus-service            ClusterIP      34.118.232.126   <none>        9090/TCP         15h

NAME                                  READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/grafana               1/1     1            1           15h
deployment.apps/healthcare-backend    2/2     1            2           15h
deployment.apps/healthcare-frontend   2/2     1            2           15h
deployment.apps/healthcare-mongodb    1/1     1            1           15h
deployment.apps/prometheus            1/1     1            1           15h

NAME                                             DESIRED   CURRENT   READY   AGE
replicaset.apps/grafana-58475648cd               0         0         0       15h
replicaset.apps/grafana-7d8687f94b               1         1         1       14h
replicaset.apps/healthcare-backend-54f857c94     0         0         0       8h
replicaset.apps/healthcare-backend-55b65f569f    0         0         0       10h
replicaset.apps/healthcare-backend-58b687958d    0         0         0       8h
replicaset.apps/healthcare-backend-5bfc8b8cbc    0         0         0       8h
replicaset.apps/healthcare-backend-5dd44b476c    0         0         0       9h
replicaset.apps/healthcare-backend-5f475c7645    0         0         0       7h59m
replicaset.apps/healthcare-backend-5f6f77c544    0         0         0       10h
replicaset.apps/healthcare-backend-669fc45b84    0         0         0       8h
replicaset.apps/healthcare-backend-68978ccd5f    0         0         0       9h
replicaset.apps/healthcare-backend-7f54f89c96    2         2         2       7h51m
replicaset.apps/healthcare-backend-84cb878467    1         1         0       2s
replicaset.apps/healthcare-backend-f48f5cb4f     0         0         0       9h
replicaset.apps/healthcare-frontend-54d88bf7f9   0         0         0       10h
replicaset.apps/healthcare-frontend-56944b4d78   0         0         0       8h
replicaset.apps/healthcare-frontend-56c8d678b8   0         0         0       8h
replicaset.apps/healthcare-frontend-577cc8d46    0         0         0       9h
replicaset.apps/healthcare-frontend-5c55cd69fd   0         0         0       10h
replicaset.apps/healthcare-frontend-5dcfd8d8db   0         0         0       8h
replicaset.apps/healthcare-frontend-5fc78f64f7   0         0         0       7h59m
replicaset.apps/healthcare-frontend-64cb6bd4db   0         0         0       10h
replicaset.apps/healthcare-frontend-654d97f9db   0         0         0       6s
replicaset.apps/healthcare-frontend-6569695659   0         0         0       8h
replicaset.apps/healthcare-frontend-69878745fc   0         0         0       9h
replicaset.apps/healthcare-frontend-76775dc848   2         2         2       7h50m
replicaset.apps/healthcare-frontend-d568fdf6b    1         1         0       1s
replicaset.apps/healthcare-mongodb-5767d8bc5     0         0         0       15h
replicaset.apps/healthcare-mongodb-79f785c8c8    0         0         0       15h
replicaset.apps/healthcare-mongodb-7dbb88f5b     1         1         1       11h
replicaset.apps/prometheus-6ddcd97d89            1         1         0       14h
replicaset.apps/prometheus-7bbfb5596c            1         1         1       15h
replicaset.apps/prometheus-b8ffb5f48             0         0         0       15h
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Health Check)
[Pipeline] script
[Pipeline] {
[Pipeline] echo
Performing final health checks...
[Pipeline] sh
+ echo === APPLICATION ACCESS INFORMATION ===
=== APPLICATION ACCESS INFORMATION ===
+ /usr/local/bin/kubectl get pods -n healthcare-app
NAME                                   READY   STATUS             RESTARTS         AGE
grafana-7d8687f94b-bkq58               1/1     Running            0                14h
healthcare-backend-7f54f89c96-2xphj    1/1     Running            0                3h
healthcare-backend-7f54f89c96-cqfgq    1/1     Running            0                3h57m
healthcare-backend-84cb878467-jv47v    0/1     Pending            0                1s
healthcare-frontend-654d97f9db-lpgzm   0/1     Terminating        0                5s
healthcare-frontend-76775dc848-f82dd   1/1     Running            0                7h47m
healthcare-frontend-76775dc848-jtqrj   1/1     Running            0                3h
healthcare-frontend-d568fdf6b-7wpl5    0/1     Pending            0                1s
healthcare-mongodb-7dbb88f5b-thr5l     1/1     Running            0                11h
prometheus-6ddcd97d89-h9qwh            0/1     CrashLoopBackOff   51 (2m52s ago)   3h57m
prometheus-7bbfb5596c-9wzzr            1/1     Running            0                14h
+ /usr/local/bin/kubectl get services -n healthcare-app
NAME                          TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
grafana-service               NodePort       34.118.226.7     <none>        3000:30081/TCP   15h
healthcare-backend-service    ClusterIP      34.118.231.138   <none>        5002/TCP         15h
healthcare-frontend-service   LoadBalancer   34.118.228.162   <pending>     80:30836/TCP     15h
healthcare-mongodb-service    ClusterIP      34.118.236.5     <none>        27017/TCP        15h
prometheus-service            ClusterIP      34.118.232.126   <none>        9090/TCP         15h
+ /usr/local/bin/kubectl get ingress -n healthcare-app
NAME                 CLASS    HOSTS   ADDRESS         PORTS   AGE
healthcare-ingress   <none>   *       34.93.179.126   80      7h59m
+ /usr/local/bin/kubectl get svc -n ingress-nginx ingress-nginx-controller -o jsonpath={.status.loadBalancer.ingress[0].ip}
+ INGRESS_IP=34.93.179.126
+ /usr/local/bin/kubectl get service healthcare-frontend-service -n healthcare-app -o jsonpath={.status.loadBalancer.ingress[0].ip}
+ FRONTEND_EXTERNAL_IP=
+ [ -z  ]
+ echo 

+ echo 🎉 HEALTHCARE APPLICATION DEPLOYED SUCCESSFULLY!
🎉 HEALTHCARE APPLICATION DEPLOYED SUCCESSFULLY!
+ echo ================================================
================================================
+ echo ⏳ LoadBalancer External IP is being assigned...
⏳ LoadBalancer External IP is being assigned...
+ echo 🔧 Use kubectl port-forward for testing:
🔧 Use kubectl port-forward for testing:
+ echo    kubectl port-forward service/healthcare-frontend-service 3000:80 -n healthcare-app
   kubectl port-forward service/healthcare-frontend-service 3000:80 -n healthcare-app
+ echo    kubectl port-forward service/healthcare-backend-service 5002:5002 -n healthcare-app
   kubectl port-forward service/healthcare-backend-service 5002:5002 -n healthcare-app
+ echo ================================================
================================================
+ echo ✅ Frontend: LoadBalancer (Port 80)
✅ Frontend: LoadBalancer (Port 80)
+ echo ✅ Backend: ClusterIP (Port 5002 - Internal)
✅ Backend: ClusterIP (Port 5002 - Internal)
+ echo ✅ Database: ClusterIP (Port 27017 - Internal)
✅ Database: ClusterIP (Port 27017 - Internal)
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Declarative: Post Actions)
[Pipeline] echo
Cleaning up...
[Pipeline] sh
+ docker system prune -f
Total reclaimed space: 0B
[Pipeline] echo
Pipeline completed successfully!
[Pipeline] script
[Pipeline] {
[Pipeline] sh
+ echo ==========================================
==========================================
+ echo 🎉 3-TIER ARCHITECTURE + MONITORING DEPLOYED
🎉 3-TIER ARCHITECTURE + MONITORING DEPLOYED
+ echo ==========================================
==========================================
+ echo ✅ Database Tier: MongoDB (healthcare-mongodb)
✅ Database Tier: MongoDB (healthcare-mongodb)
+ echo ✅ Backend Tier: Node.js API (healthcare-backend)
✅ Backend Tier: Node.js API (healthcare-backend)
+ echo ✅ Frontend Tier: React App (healthcare-frontend)
✅ Frontend Tier: React App (healthcare-frontend)
+ echo ✅ Monitoring: Prometheus + Grafana
✅ Monitoring: Prometheus + Grafana
+ echo 

+ kubectl get service healthcare-frontend-service -n healthcare-app -o jsonpath={.status.loadBalancer.ingress[0].ip}
+ FRONTEND_IP=
+ kubectl get service healthcare-backend-service -n healthcare-app -o jsonpath={.spec.clusterIP}
+ BACKEND_CLUSTER_IP=34.118.231.138
+ [  != PENDING ]
+ [  !=  ]
+ echo 🌐 Healthcare App: LoadBalancer IP pending assignment
🌐 Healthcare App: LoadBalancer IP pending assignment
+ echo 🔧 Test locally: kubectl port-forward service/healthcare-frontend-service 3000:80 -n healthcare-app
🔧 Test locally: kubectl port-forward service/healthcare-frontend-service 3000:80 -n healthcare-app
+ echo 🏥 Backend (Internal): 34.118.231.138:5002
🏥 Backend (Internal): 34.118.231.138:5002
+ echo 

+ echo Complete 3-tier architecture with monitoring is now live!
Complete 3-tier architecture with monitoring is now live!
+ echo ==========================================
==========================================
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // node
[Pipeline] End of Pipeline
Finished: SUCCESS
