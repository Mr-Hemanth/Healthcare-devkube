Started by user Hemanth Reddy
Obtained Jenkinsfile from git https://github.com/Mr-Hemanth/Healthcare-devkube.git
[Pipeline] Start of Pipeline
[Pipeline] node
Running on Jenkins in /var/lib/jenkins/workspace/healthcare-devkube-pipeline
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Declarative: Checkout SCM)
[Pipeline] checkout
Selected Git installation does not exist. Using Default
The recommended git tool is: NONE
using credential github-pat
 > git rev-parse --resolve-git-dir /var/lib/jenkins/workspace/healthcare-devkube-pipeline/.git # timeout=10
Fetching changes from the remote Git repository
 > git config remote.origin.url https://github.com/Mr-Hemanth/Healthcare-devkube.git # timeout=10
Fetching upstream changes from https://github.com/Mr-Hemanth/Healthcare-devkube.git
 > git --version # timeout=10
 > git --version # 'git version 2.34.1'
using GIT_ASKPASS to set credentials GitHub Personal Access Token
 > git fetch --tags --force --progress -- https://github.com/Mr-Hemanth/Healthcare-devkube.git +refs/heads/*:refs/remotes/origin/* # timeout=10
 > git rev-parse refs/remotes/origin/main^{commit} # timeout=10
Checking out Revision 9d07079ee2cefeb815f894370624dfa4e7e12ed6 (refs/remotes/origin/main)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f 9d07079ee2cefeb815f894370624dfa4e7e12ed6 # timeout=10
Commit message: "made k8s ingtess"
 > git rev-list --no-walk fcaf69874fe25364ac22e6540e8f075cd8631045 # timeout=10
[Pipeline] }
[Pipeline] // stage
[Pipeline] withEnv
[Pipeline] {
[Pipeline] withCredentials
Masking supported pattern matches of $SERVICE_ACCOUNT_KEY
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Checkout)
[Pipeline] echo
Checking out source code...
[Pipeline] checkout
Selected Git installation does not exist. Using Default
The recommended git tool is: NONE
using credential github-pat
 > git rev-parse --resolve-git-dir /var/lib/jenkins/workspace/healthcare-devkube-pipeline/.git # timeout=10
Fetching changes from the remote Git repository
 > git config remote.origin.url https://github.com/Mr-Hemanth/Healthcare-devkube.git # timeout=10
Fetching upstream changes from https://github.com/Mr-Hemanth/Healthcare-devkube.git
 > git --version # timeout=10
 > git --version # 'git version 2.34.1'
using GIT_ASKPASS to set credentials GitHub Personal Access Token
 > git fetch --tags --force --progress -- https://github.com/Mr-Hemanth/Healthcare-devkube.git +refs/heads/*:refs/remotes/origin/* # timeout=10
 > git rev-parse refs/remotes/origin/main^{commit} # timeout=10
Checking out Revision 9d07079ee2cefeb815f894370624dfa4e7e12ed6 (refs/remotes/origin/main)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f 9d07079ee2cefeb815f894370624dfa4e7e12ed6 # timeout=10
Commit message: "made k8s ingtess"
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Verify Prerequisites)
[Pipeline] script
[Pipeline] {
[Pipeline] echo
Verifying all required tools are properly installed...
[Pipeline] sh
+ echo === Environment Verification ===
=== Environment Verification ===
+ whoami
+ echo Current user: jenkins
Current user: jenkins
+ echo Current PATH: /usr/local/bin:/snap/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
Current PATH: /usr/local/bin:/snap/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
+ pwd
+ echo Working directory: /var/lib/jenkins/workspace/healthcare-devkube-pipeline
Working directory: /var/lib/jenkins/workspace/healthcare-devkube-pipeline
+ echo === Tool Verification ===
=== Tool Verification ===
+ node --version
+ echo Node.js: v18.20.8
Node.js: v18.20.8
+ npm --version
+ echo npm: 10.8.2
npm: 10.8.2
+ docker --version
+ echo Docker: Docker version 27.5.1, build 27.5.1-0ubuntu3~22.04.2
Docker: Docker version 27.5.1, build 27.5.1-0ubuntu3~22.04.2
+ [ -f /usr/local/bin/gcloud ]
+ /usr/local/bin/gcloud --version
+ head -1
Updates are available for some Google Cloud CLI components.  To install them,
please run:
  $ gcloud components update
+ echo gcloud: Google Cloud SDK 456.0.0
gcloud: Google Cloud SDK 456.0.0
+ [ -f /usr/local/bin/kubectl ]
+ /usr/local/bin/kubectl version --client
+ head -1
+ echo kubectl: Client Version: v1.34.1
kubectl: Client Version: v1.34.1
+ [ -f /usr/local/bin/gke-gcloud-auth-plugin ]
+ /usr/local/bin/gke-gcloud-auth-plugin --version
+ echo gke-auth-plugin: Kubernetes v1.28.0-alpha+918af8f95e54adc06c7f33df3ab7c68bd24fc278
gke-auth-plugin: Kubernetes v1.28.0-alpha+918af8f95e54adc06c7f33df3ab7c68bd24fc278
+ echo ‚úÖ All prerequisites verified successfully!
‚úÖ All prerequisites verified successfully!
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Setup GCP Authentication)
[Pipeline] script
[Pipeline] {
[Pipeline] echo
Setting up GCP authentication...
[Pipeline] sh
+ export USE_GKE_GCLOUD_AUTH_PLUGIN=True
+ echo Authenticating with service account...
Authenticating with service account...
+ /usr/local/bin/gcloud auth activate-service-account --key-file=****
Activated service account credentials for: [jenkins-sa@hc-3-monitoring.iam.gserviceaccount.com]
+ echo Setting project...
Setting project...
+ /usr/local/bin/gcloud config set project hc-3-monitoring
Updated property [core/project].
+ echo Configuring Docker authentication...
Configuring Docker authentication...
+ /usr/local/bin/gcloud auth configure-docker asia-south1-docker.pkg.dev --quiet
WARNING: Your config file at [/var/lib/jenkins/.docker/config.json] contains these credential helper entries:

{
  "credHelpers": {
    "asia-south1-docker.pkg.dev": "gcloud"
  }
}
Adding credentials for: asia-south1-docker.pkg.dev
gcloud credential helpers already registered correctly.
+ echo ‚úÖ GCP authentication setup complete
‚úÖ GCP authentication setup complete
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Test Backend)
[Pipeline] dir
Running in /var/lib/jenkins/workspace/healthcare-devkube-pipeline/server
[Pipeline] {
[Pipeline] script
[Pipeline] {
[Pipeline] echo
Testing Backend Application...
[Pipeline] sh
+ echo Installing backend dependencies...
Installing backend dependencies...
+ npm install

up to date, audited 112 packages in 1s

16 packages are looking for funding
  run `npm fund` for details

5 vulnerabilities (3 high, 2 critical)

To address all issues, run:
  npm audit fix

Run `npm audit` for details.
+ echo Running syntax check...
Running syntax check...
+ node -c server.js
+ echo ‚úÖ Backend tests passed
‚úÖ Backend tests passed
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // dir
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Test Frontend)
[Pipeline] dir
Running in /var/lib/jenkins/workspace/healthcare-devkube-pipeline/client
[Pipeline] {
[Pipeline] script
[Pipeline] {
[Pipeline] echo
Testing Frontend Application...
[Pipeline] sh
+ echo Installing frontend dependencies...
Installing frontend dependencies...
+ npm install

up to date, audited 1509 packages in 6s

271 packages are looking for funding
  run `npm fund` for details

22 vulnerabilities (3 low, 7 moderate, 10 high, 2 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.
+ echo Running tests...
Running tests...
+ CI=true npm test -- --coverage --watchAll=false

> client@0.1.0 test
> react-scripts test --coverage --watchAll=false

  console.error
    Warning: `ReactDOMTestUtils.act` is deprecated in favor of `React.act`. Import `act` from `react` instead of `react-dom/test-utils`. See https://react.dev/warnings/react-dom-test-utils for more info.

    [0m [90m 3 |[39m
     [90m 4 |[39m test([32m'renders healthcare welcome message'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 5 |[39m   render([33m<[39m[33mApp[39m [33m/[39m[33m>[39m)[33m;[39m
     [90m   |[39m         [31m[1m^[22m[39m
     [90m 6 |[39m   [36mconst[39m welcomeElement [33m=[39m screen[33m.[39mgetByText([35m/Welcome to Healthcare Management System/i[39m)[33m;[39m
     [90m 7 |[39m   expect(welcomeElement)[33m.[39mtoBeInTheDocument()[33m;[39m
     [90m 8 |[39m })[33m;[39m[0m

      at printWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:71:30)
      at error (node_modules/react-dom/cjs/react-dom-test-utils.development.js:45:7)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1736:7)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:159:26)
      at render (node_modules/@testing-library/react/dist/pure.js:246:10)
      at Object.<anonymous> (src/App.test.js:5:9)
      at TestScheduler.scheduleTests (node_modules/@jest/core/build/TestScheduler.js:333:13)
      at runJest (node_modules/@jest/core/build/runJest.js:404:19)
      at _run10000 (node_modules/@jest/core/build/cli/index.js:320:7)
      at runCLI (node_modules/@jest/core/build/cli/index.js:173:3)

PASS src/App.test.js
  ‚úì renders healthcare welcome message (128 ms)

----------------------------|---------|----------|---------|---------|-------------------------------
File                        | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s             
----------------------------|---------|----------|---------|---------|-------------------------------
All files                   |   36.42 |      4.6 |    8.98 |   36.42 |                               
 src                        |    9.09 |        0 |   33.33 |    9.09 |                               
  App.js                    |     100 |      100 |     100 |     100 |                               
  index.js                  |       0 |      100 |     100 |       0 | 6-7                           
  reportWebVitals.js        |       0 |        0 |       0 |       0 | 1-8                           
 src/components             |    35.5 |     0.78 |     4.1 |    35.5 |                               
  About.js                  |   16.66 |      100 |       0 |   16.66 | 4-33                          
  AdminPage.js              |       5 |        0 |       0 |       5 | 5-111                         
  AppointmentScheduling.js  |      50 |        0 |       0 |      50 | 6-147                         
  Billing.js                |   48.78 |        0 |       0 |   48.78 | 6-219                         
  Footer.js                 |     100 |      100 |     100 |     100 |                               
  Home.js                   |      10 |      100 |       0 |      10 | 6-217                         
  Login.js                  |     2.5 |        0 |       0 |     2.5 | 8-146                         
  MedicalRecord.js          |      50 |        0 |       0 |      50 | 6-166                         
  Navbar.js                 |      50 |       25 |    8.33 |      50 | 10-11,75-119                  
  ProtectedRoute.js         |    12.5 |        0 |       0 |    12.5 | 6-50                          
  Signup.js                 |   17.64 |        0 |       0 |   17.64 | 7-165                         
  UnauthorizedAccess.js     |       0 |      100 |       0 |       0 | 4-5                           
  Welcome.js                |     100 |      100 |     100 |     100 |                               
 src/config                 |   40.74 |       25 |   16.66 |   40.74 |                               
  api.js                    |   40.74 |       25 |   16.66 |   40.74 | 17-20,25,31-36,67,82-87,94-99 
 src/context                |   62.06 |       50 |      60 |   62.06 |                               
  AuthContext.js            |   62.06 |       50 |      60 |   62.06 | 8,24-25,31-34,38-41           
 src/hooks                  |    12.5 |        0 |       0 |    12.5 |                               
  useProtectedNavigation.js |    12.5 |        0 |       0 |    12.5 | 5-16                          
----------------------------|---------|----------|---------|---------|-------------------------------
Test Suites: 1 passed, 1 total
Tests:       1 passed, 1 total
Snapshots:   0 total
Time:        3.733 s
Ran all test suites.
+ echo ‚úÖ Frontend tests passed
‚úÖ Frontend tests passed
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // dir
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Build Docker Images)
[Pipeline] parallel
[Pipeline] { (Branch: Build Backend Image)
[Pipeline] { (Branch: Build Frontend Image)
[Pipeline] stage
[Pipeline] { (Build Backend Image)
[Pipeline] stage
[Pipeline] { (Build Frontend Image)
[Pipeline] dir
Running in /var/lib/jenkins/workspace/healthcare-devkube-pipeline/server
[Pipeline] {
[Pipeline] dir
Running in /var/lib/jenkins/workspace/healthcare-devkube-pipeline/client
[Pipeline] {
[Pipeline] script
[Pipeline] {
[Pipeline] script
[Pipeline] {
[Pipeline] echo
Building Backend Docker Image...
[Pipeline] sh
[Pipeline] echo
Building Frontend Docker Image...
[Pipeline] sh
+ echo Building: asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-backend:27
Building: asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-backend:27
+ docker build -t asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-backend:27 .
DEPRECATED: The legacy builder is deprecated and will be removed in a future release.
            Install the buildx component to build images with BuildKit:
            https://docs.docker.com/go/buildx/

+ echo Building: asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-frontend:27
Building: asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-frontend:27
+ echo Setting API base URL for browser access via ingress...
Setting API base URL for browser access via ingress...
+ docker build --build-arg REACT_APP_API_BASE_URL= -t asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-frontend:27 .
DEPRECATED: The legacy builder is deprecated and will be removed in a future release.
            Install the buildx component to build images with BuildKit:
            https://docs.docker.com/go/buildx/

Sending build context to Docker daemon  1.674MB

Step 1/15 : FROM node:18-alpine
 ---> ee77c6cd7c18
Step 2/15 : WORKDIR /usr/src/app
 ---> Using cache
 ---> d5b6982b3eec
Step 3/15 : COPY package*.json ./
 ---> Using cache
 ---> 44786eaadbaf
Step 4/15 : RUN npm ci && npm cache clean --force
 ---> Using cache
 ---> 06d2fe61e4f4
Step 5/15 : COPY . .
 ---> 6ed8c90315a5
Step 6/15 : ARG REACT_APP_API_BASE_URL
 ---> Running in 19420c33af64
 ---> Removed intermediate container 19420c33af64
 ---> fbb0ad8f9f6d
Step 7/15 : ENV REACT_APP_API_BASE_URL=$REACT_APP_API_BASE_URL
 ---> Running in ce2a88647451
Sending build context to Docker daemon  20.92MB

Step 1/10 : FROM node:18-alpine
 ---> ee77c6cd7c18
Step 2/10 : WORKDIR /app
 ---> Using cache
 ---> b114ec080dd9
Step 3/10 : COPY package*.json ./
 ---> Using cache
 ---> b1bf93e01a98
Step 4/10 : RUN npm ci --only=production && npm cache clean --force
 ---> Using cache
 ---> 5b8c6256d7af
Step 5/10 : RUN addgroup -g 1001 -S nodejs
 ---> Using cache
 ---> e04cbc3e6f71
Step 6/10 : RUN adduser -S nodejs -u 1001
 ---> Using cache
 ---> 78135c2adf68
Step 7/10 : COPY --chown=nodejs:nodejs . .
 ---> Using cache
 ---> f8f1a9674f36
Step 8/10 : USER nodejs
 ---> Using cache
 ---> be2e12d695ff
Step 9/10 : EXPOSE 5002
 ---> Using cache
 ---> b59bc7e26e05
Step 10/10 : CMD ["node", "server.js"]
 ---> Using cache
 ---> 589a8208dee7
Successfully built 589a8208dee7
Successfully tagged asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-backend:27
+ docker tag asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-backend:27 asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-backend:latest
+ echo ‚úÖ Backend image built successfully
‚úÖ Backend image built successfully
 ---> Removed intermediate container ce2a88647451
 ---> 3b3cb9aece99
Step 8/15 : RUN npm run build
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // dir
[Pipeline] }
 ---> Running in 0b95d24ea75a
[Pipeline] // stage
[Pipeline] }

> client@0.1.0 build
> react-scripts build

Creating an optimized production build...
[91mBrowserslist: browsers data (caniuse-lite) is 11 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
[0m[91m[0;33mOne of your dependencies, babel-preset-react-app, is importing the
"@babel/plugin-proposal-private-property-in-object" package without
declaring it in its dependencies. This is currently working because
"@babel/plugin-proposal-private-property-in-object" is already in your
node_modules folder for unrelated reasons, but it [1mmay break at any time[0;33m.

babel-preset-react-app is part of the create-react-app project, [1mwhich
is not maintianed anymore[0;33m. It is thus unlikely that this bug will
ever be fixed. Add "@babel/plugin-proposal-private-property-in-object" to
your devDependencies to work around this error. This will make this message
go away.[0m
  
[0m[91mBrowserslist: browsers data (caniuse-lite) is 11 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
[0mCompiled with warnings.

[eslint] 
src/config/api.js
  Line 103:1:  Assign object to a variable before exporting as module default  import/no-anonymous-default-export

Search for the keywords to learn more about each warning.
To ignore, add // eslint-disable-next-line to the line before.

File sizes after gzip:

  134.74 kB  build/static/js/main.34b5e18d.js
  1.09 kB    build/static/css/main.3ebbdcc8.css

The project was built assuming it is hosted at /.
You can control this with the homepage field in your package.json.

The build folder is ready to be deployed.
You may serve it with a static server:

  npm install -g serve
  serve -s build

Find out more about deployment here:

  https://cra.link/deployment

 ---> Removed intermediate container 0b95d24ea75a
 ---> 6809e78ee159
Step 9/15 : RUN npm install -g serve
 ---> Running in d7aa6dd18704

added 86 packages in 6s

25 packages are looking for funding
  run `npm fund` for details
 ---> Removed intermediate container d7aa6dd18704
 ---> b04b51bc088e
Step 10/15 : RUN addgroup -g 1001 -S nodejs
 ---> Running in f806a72bf468
 ---> Removed intermediate container f806a72bf468
 ---> df2ed5972e81
Step 11/15 : RUN adduser -S nextjs -u 1001
 ---> Running in 7027ebd9d5dc
 ---> Removed intermediate container 7027ebd9d5dc
 ---> 4991ceb4218b
Step 12/15 : RUN chown -R nextjs:nodejs /usr/src/app/build
 ---> Running in aa9bf981bbe8
 ---> Removed intermediate container aa9bf981bbe8
 ---> 3c40a527b8b9
Step 13/15 : USER nextjs
 ---> Running in 83216362f165
 ---> Removed intermediate container 83216362f165
 ---> d02fa8b72746
Step 14/15 : EXPOSE 3000
 ---> Running in dd109bd64788
 ---> Removed intermediate container dd109bd64788
 ---> b6fd6773b896
Step 15/15 : CMD ["serve", "-s", "build", "-l", "3000"]
 ---> Running in cc7deb151692
 ---> Removed intermediate container cc7deb151692
 ---> 2f23cde8cbf8
Successfully built 2f23cde8cbf8
Successfully tagged asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-frontend:27
+ docker tag asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-frontend:27 asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-frontend:latest
+ echo ‚úÖ Frontend image built successfully with Kubernetes API URL
‚úÖ Frontend image built successfully with Kubernetes API URL
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // dir
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // parallel
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Push Images to Artifact Registry)
[Pipeline] parallel
[Pipeline] { (Branch: Push Backend Image)
[Pipeline] { (Branch: Push Frontend Image)
[Pipeline] stage
[Pipeline] { (Push Backend Image)
[Pipeline] stage
[Pipeline] { (Push Frontend Image)
[Pipeline] script
[Pipeline] {
[Pipeline] script
[Pipeline] {
[Pipeline] echo
Pushing Backend Images...
[Pipeline] sh
[Pipeline] echo
Pushing Frontend Images...
[Pipeline] sh
+ docker push asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-backend:27
+ docker push asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-frontend:27
The push refers to repository [asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-backend]
6cc733efde0a: Preparing
66ef3b520668: Preparing
fc57048cf79c: Preparing
698bcc6679dc: Preparing
1d8dfb065721: Preparing
b34c57d81995: Preparing
82140d9a70a7: Preparing
f3b40b0cdb1c: Preparing
0b1f26057bd0: Preparing
08000c18d16d: Preparing
b34c57d81995: Waiting
82140d9a70a7: Waiting
f3b40b0cdb1c: Waiting
0b1f26057bd0: Waiting
08000c18d16d: Waiting
6cc733efde0a: Layer already exists
1d8dfb065721: Layer already exists
698bcc6679dc: Layer already exists
66ef3b520668: Layer already exists
fc57048cf79c: Layer already exists
b34c57d81995: Layer already exists
82140d9a70a7: Layer already exists
0b1f26057bd0: Layer already exists
f3b40b0cdb1c: Layer already exists
08000c18d16d: Layer already exists
The push refers to repository [asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-frontend]
4fae8e8c9608: Preparing
505097f268fc: Preparing
315b244ab65a: Preparing
f9913735878c: Preparing
8a3e9294ebf4: Preparing
625eaa9b7848: Preparing
835be13f7842: Preparing
3ba7933f0c87: Preparing
b24b8265f24c: Preparing
82140d9a70a7: Preparing
4fae8e8c9608: Waiting
f3b40b0cdb1c: Preparing
0b1f26057bd0: Preparing
08000c18d16d: Preparing
505097f268fc: Waiting
625eaa9b7848: Waiting
835be13f7842: Waiting
315b244ab65a: Waiting
3ba7933f0c87: Waiting
b24b8265f24c: Waiting
f9913735878c: Waiting
8a3e9294ebf4: Waiting
82140d9a70a7: Waiting
f3b40b0cdb1c: Waiting
0b1f26057bd0: Waiting
08000c18d16d: Waiting
27: digest: sha256:36d5f76be2281064397620cb46ce2607185169c1b6363569a795da8ef03431ee size: 2409
+ docker push asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-backend:latest
505097f268fc: Pushed
315b244ab65a: Pushed
835be13f7842: Layer already exists
4fae8e8c9608: Pushed
3ba7933f0c87: Layer already exists
b24b8265f24c: Layer already exists
82140d9a70a7: Layer already exists
f3b40b0cdb1c: Layer already exists
0b1f26057bd0: Layer already exists
08000c18d16d: Layer already exists
625eaa9b7848: Pushed
8a3e9294ebf4: Pushed
f9913735878c: Pushed
The push refers to repository [asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-backend]
6cc733efde0a: Preparing
66ef3b520668: Preparing
fc57048cf79c: Preparing
698bcc6679dc: Preparing
1d8dfb065721: Preparing
b34c57d81995: Preparing
82140d9a70a7: Preparing
f3b40b0cdb1c: Preparing
0b1f26057bd0: Preparing
08000c18d16d: Preparing
b34c57d81995: Waiting
82140d9a70a7: Waiting
f3b40b0cdb1c: Waiting
0b1f26057bd0: Waiting
08000c18d16d: Waiting
fc57048cf79c: Layer already exists
698bcc6679dc: Layer already exists
66ef3b520668: Layer already exists
1d8dfb065721: Layer already exists
6cc733efde0a: Layer already exists
f3b40b0cdb1c: Layer already exists
b34c57d81995: Layer already exists
82140d9a70a7: Layer already exists
08000c18d16d: Layer already exists
0b1f26057bd0: Layer already exists
latest: digest: sha256:36d5f76be2281064397620cb46ce2607185169c1b6363569a795da8ef03431ee size: 2409
+ echo ‚úÖ Backend images pushed
‚úÖ Backend images pushed
[Pipeline] }
27: digest: sha256:fefd9d2678f23246512128852f29922d506a93dbf29347200700445dbe06e035 size: 3043
+ docker push asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-frontend:latest
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
The push refers to repository [asia-south1-docker.pkg.dev/hc-3-monitoring/healthcare-repo/healthcare-frontend]
4fae8e8c9608: Preparing
505097f268fc: Preparing
315b244ab65a: Preparing
f9913735878c: Preparing
8a3e9294ebf4: Preparing
625eaa9b7848: Preparing
835be13f7842: Preparing
3ba7933f0c87: Preparing
b24b8265f24c: Preparing
82140d9a70a7: Preparing
f3b40b0cdb1c: Preparing
0b1f26057bd0: Preparing
08000c18d16d: Preparing
625eaa9b7848: Waiting
835be13f7842: Waiting
3ba7933f0c87: Waiting
b24b8265f24c: Waiting
82140d9a70a7: Waiting
f3b40b0cdb1c: Waiting
0b1f26057bd0: Waiting
08000c18d16d: Waiting
f9913735878c: Layer already exists
4fae8e8c9608: Layer already exists
315b244ab65a: Layer already exists
505097f268fc: Layer already exists
8a3e9294ebf4: Layer already exists
625eaa9b7848: Layer already exists
835be13f7842: Layer already exists
b24b8265f24c: Layer already exists
3ba7933f0c87: Layer already exists
82140d9a70a7: Layer already exists
f3b40b0cdb1c: Layer already exists
0b1f26057bd0: Layer already exists
08000c18d16d: Layer already exists
latest: digest: sha256:fefd9d2678f23246512128852f29922d506a93dbf29347200700445dbe06e035 size: 3043
+ echo ‚úÖ Frontend images pushed
‚úÖ Frontend images pushed
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // parallel
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Deploy to GKE)
[Pipeline] script
[Pipeline] {
[Pipeline] echo
Deploying to Google Kubernetes Engine...
[Pipeline] sh
+ export USE_GKE_GCLOUD_AUTH_PLUGIN=True
+ echo Re-authenticating for cluster access...
Re-authenticating for cluster access...
+ /usr/local/bin/gcloud auth activate-service-account --key-file=****
Activated service account credentials for: [jenkins-sa@hc-3-monitoring.iam.gserviceaccount.com]
+ /usr/local/bin/gcloud config set project hc-3-monitoring
Updated property [core/project].
+ echo Getting cluster credentials...
Getting cluster credentials...
+ /usr/local/bin/gcloud container clusters get-credentials healthcare3-cluster --location=asia-south1
Fetching cluster endpoint and auth data.
kubeconfig entry generated for healthcare3-cluster.
+ echo Testing cluster connection...
Testing cluster connection...
+ /usr/local/bin/kubectl cluster-info --request-timeout=10s
Kubernetes control plane is running at https://34.14.209.19
GLBCDefaultBackend is running at https://34.14.209.19/api/v1/namespaces/kube-system/services/default-http-backend:http/proxy
KubeDNS is running at https://34.14.209.19/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
Metrics-server is running at https://34.14.209.19/api/v1/namespaces/kube-system/services/https:metrics-server:/proxy

To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.
+ echo Deploying application with corrected configurations...
Deploying application with corrected configurations...
+ /usr/local/bin/kubectl apply -f k8s/namespace.yaml
namespace/healthcare-app unchanged
+ /usr/local/bin/kubectl apply -f k8s/configmap.yaml
configmap/healthcare-config unchanged
secret/healthcare-secrets unchanged
+ echo Option 1: Deploy with local MongoDB (full 3-tier)
Option 1: Deploy with local MongoDB (full 3-tier)
+ /usr/local/bin/kubectl apply -f k8s/database-deployment.yaml
deployment.apps/healthcare-mongodb unchanged
service/healthcare-mongodb-service unchanged
persistentvolumeclaim/mongodb-data-pvc unchanged
persistentvolumeclaim/mongodb-config-pvc unchanged
+ /usr/local/bin/kubectl apply -f k8s/backend-deployment.yaml
deployment.apps/healthcare-backend unchanged
service/healthcare-backend-service unchanged
+ /usr/local/bin/kubectl apply -f k8s/frontend-deployment.yaml
deployment.apps/healthcare-frontend unchanged
service/healthcare-frontend-service unchanged
+ echo Optional: Deploy monitoring stack
Optional: Deploy monitoring stack
+ /usr/local/bin/kubectl apply -f k8s/monitoring-prometheus.yaml
configmap/prometheus-config unchanged
deployment.apps/prometheus unchanged
service/prometheus-service unchanged
persistentvolumeclaim/prometheus-data-pvc unchanged
serviceaccount/prometheus-service-account unchanged
clusterrole.rbac.authorization.k8s.io/prometheus-cluster-role unchanged
clusterrolebinding.rbac.authorization.k8s.io/prometheus-cluster-role-binding unchanged
+ /usr/local/bin/kubectl apply -f k8s/monitoring-grafana.yaml
configmap/grafana-config unchanged
deployment.apps/grafana unchanged
service/grafana-service unchanged
persistentvolumeclaim/grafana-data-pvc unchanged
+ echo Optional: Deploy ingress if available
Optional: Deploy ingress if available
+ /usr/local/bin/kubectl apply -f k8s/ingress.yaml
ingress.networking.k8s.io/healthcare-ingress unchanged
+ echo Waiting for deployments...
Waiting for deployments...
+ /usr/local/bin/kubectl wait --for=condition=available deployment/healthcare-mongodb -n healthcare-app --timeout=300s
deployment.apps/healthcare-mongodb condition met
+ /usr/local/bin/kubectl wait --for=condition=available deployment/prometheus -n healthcare-app --timeout=300s
deployment.apps/prometheus condition met
+ /usr/local/bin/kubectl wait --for=condition=available deployment/grafana -n healthcare-app --timeout=300s
deployment.apps/grafana condition met
+ echo Restarting application deployments...
Restarting application deployments...
+ /usr/local/bin/kubectl rollout restart deployment/healthcare-backend -n healthcare-app
deployment.apps/healthcare-backend restarted
+ /usr/local/bin/kubectl rollout restart deployment/healthcare-frontend -n healthcare-app
deployment.apps/healthcare-frontend restarted
+ echo Waiting for application deployments...
Waiting for application deployments...
+ /usr/local/bin/kubectl wait --for=condition=available deployment/healthcare-backend -n healthcare-app --timeout=300s
deployment.apps/healthcare-backend condition met
+ /usr/local/bin/kubectl wait --for=condition=available deployment/healthcare-frontend -n healthcare-app --timeout=300s
deployment.apps/healthcare-frontend condition met
+ echo ‚úÖ Deployment completed!
‚úÖ Deployment completed!
+ /usr/local/bin/kubectl get all -n healthcare-app
NAME                                      READY   STATUS              RESTARTS       AGE
pod/grafana-7d8687f94b-bkq58              1/1     Running             0              14h
pod/healthcare-backend-68c6c4d6df-mtbb8   0/1     ContainerCreating   0              0s
pod/healthcare-backend-6c697d8f5d-8h2g9   1/1     Running             0              9m42s
pod/healthcare-backend-6c697d8f5d-klzrm   1/1     Running             0              9m31s
pod/healthcare-frontend-88d8758-bq2wm     1/1     Running             0              9m42s
pod/healthcare-frontend-88d8758-x4ftl     1/1     Running             0              9m30s
pod/healthcare-frontend-94b475476-855rc   0/1     ContainerCreating   0              0s
pod/healthcare-mongodb-7dbb88f5b-thr5l    1/1     Running             0              11h
pod/prometheus-6ddcd97d89-h9qwh           0/1     CrashLoopBackOff    55 (11s ago)   4h15m
pod/prometheus-7bbfb5596c-9wzzr           1/1     Running             0              15h

NAME                                  TYPE           CLUSTER-IP       EXTERNAL-IP    PORT(S)          AGE
service/grafana-service               NodePort       34.118.226.7     <none>         3000:30081/TCP   15h
service/healthcare-backend-service    ClusterIP      34.118.231.138   <none>         5002/TCP         15h
service/healthcare-frontend-service   LoadBalancer   34.118.228.162   34.100.185.1   80:30836/TCP     15h
service/healthcare-mongodb-service    ClusterIP      34.118.236.5     <none>         27017/TCP        16h
service/prometheus-service            ClusterIP      34.118.232.126   <none>         9090/TCP         16h

NAME                                  READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/grafana               1/1     1            1           15h
deployment.apps/healthcare-backend    2/2     1            2           15h
deployment.apps/healthcare-frontend   2/2     1            2           15h
deployment.apps/healthcare-mongodb    1/1     1            1           16h
deployment.apps/prometheus            1/1     1            1           16h

NAME                                             DESIRED   CURRENT   READY   AGE
replicaset.apps/grafana-58475648cd               0         0         0       15h
replicaset.apps/grafana-7d8687f94b               1         1         1       14h
replicaset.apps/healthcare-backend-54f857c94     0         0         0       9h
replicaset.apps/healthcare-backend-58b687958d    0         0         0       9h
replicaset.apps/healthcare-backend-5bfc8b8cbc    0         0         0       8h
replicaset.apps/healthcare-backend-5dd44b476c    0         0         0       9h
replicaset.apps/healthcare-backend-5f475c7645    0         0         0       8h
replicaset.apps/healthcare-backend-669fc45b84    0         0         0       8h
replicaset.apps/healthcare-backend-68978ccd5f    0         0         0       10h
replicaset.apps/healthcare-backend-68c6c4d6df    1         1         0       2s
replicaset.apps/healthcare-backend-6c697d8f5d    2         2         2       9m43s
replicaset.apps/healthcare-backend-7f54f89c96    0         0         0       8h
replicaset.apps/healthcare-backend-84cb878467    0         0         0       17m
replicaset.apps/healthcare-backend-f48f5cb4f     0         0         0       10h
replicaset.apps/healthcare-frontend-56944b4d78   0         0         0       9h
replicaset.apps/healthcare-frontend-56c8d678b8   0         0         0       9h
replicaset.apps/healthcare-frontend-577cc8d46    0         0         0       10h
replicaset.apps/healthcare-frontend-5dcfd8d8db   0         0         0       8h
replicaset.apps/healthcare-frontend-5fc78f64f7   0         0         0       8h
replicaset.apps/healthcare-frontend-654d97f9db   0         0         0       18m
replicaset.apps/healthcare-frontend-6569695659   0         0         0       8h
replicaset.apps/healthcare-frontend-69878745fc   0         0         0       9h
replicaset.apps/healthcare-frontend-76775dc848   0         0         0       8h
replicaset.apps/healthcare-frontend-88d8758      2         2         2       9m43s
replicaset.apps/healthcare-frontend-94b475476    1         1         0       1s
replicaset.apps/healthcare-frontend-d568fdf6b    0         0         0       17m
replicaset.apps/healthcare-mongodb-5767d8bc5     0         0         0       16h
replicaset.apps/healthcare-mongodb-79f785c8c8    0         0         0       15h
replicaset.apps/healthcare-mongodb-7dbb88f5b     1         1         1       12h
replicaset.apps/prometheus-6ddcd97d89            1         1         0       15h
replicaset.apps/prometheus-7bbfb5596c            1         1         1       16h
replicaset.apps/prometheus-b8ffb5f48             0         0         0       15h
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Health Check)
[Pipeline] script
[Pipeline] {
[Pipeline] echo
Performing final health checks...
[Pipeline] sh
+ echo === APPLICATION ACCESS INFORMATION ===
=== APPLICATION ACCESS INFORMATION ===
+ /usr/local/bin/kubectl get pods -n healthcare-app
NAME                                  READY   STATUS              RESTARTS       AGE
grafana-7d8687f94b-bkq58              1/1     Running             0              14h
healthcare-backend-68c6c4d6df-mtbb8   0/1     ContainerCreating   0              1s
healthcare-backend-6c697d8f5d-8h2g9   1/1     Running             0              9m43s
healthcare-backend-6c697d8f5d-klzrm   1/1     Running             0              9m32s
healthcare-frontend-88d8758-bq2wm     1/1     Running             0              9m43s
healthcare-frontend-88d8758-x4ftl     1/1     Running             0              9m31s
healthcare-frontend-94b475476-855rc   0/1     ContainerCreating   0              1s
healthcare-mongodb-7dbb88f5b-thr5l    1/1     Running             0              11h
prometheus-6ddcd97d89-h9qwh           0/1     CrashLoopBackOff    55 (12s ago)   4h15m
prometheus-7bbfb5596c-9wzzr           1/1     Running             0              15h
+ /usr/local/bin/kubectl get services -n healthcare-app
NAME                          TYPE           CLUSTER-IP       EXTERNAL-IP    PORT(S)          AGE
grafana-service               NodePort       34.118.226.7     <none>         3000:30081/TCP   15h
healthcare-backend-service    ClusterIP      34.118.231.138   <none>         5002/TCP         15h
healthcare-frontend-service   LoadBalancer   34.118.228.162   34.100.185.1   80:30836/TCP     15h
healthcare-mongodb-service    ClusterIP      34.118.236.5     <none>         27017/TCP        16h
prometheus-service            ClusterIP      34.118.232.126   <none>         9090/TCP         16h
+ /usr/local/bin/kubectl get ingress -n healthcare-app
NAME                 CLASS    HOSTS   ADDRESS         PORTS   AGE
healthcare-ingress   <none>   *       34.93.179.126   80      8h
+ /usr/local/bin/kubectl get svc -n ingress-nginx ingress-nginx-controller -o jsonpath={.status.loadBalancer.ingress[0].ip}
+ INGRESS_IP=34.93.179.126
+ /usr/local/bin/kubectl get service healthcare-frontend-service -n healthcare-app -o jsonpath={.status.loadBalancer.ingress[0].ip}
+ FRONTEND_EXTERNAL_IP=34.100.185.1
+ [ -z 34.100.185.1 ]
+ [ 34.100.185.1 = null ]
+ echo 

+ echo üéâ HEALTHCARE APPLICATION DEPLOYED SUCCESSFULLY!
üéâ HEALTHCARE APPLICATION DEPLOYED SUCCESSFULLY!
+ echo ================================================
================================================
+ echo üåê Frontend LoadBalancer: http://34.100.185.1/
üåê Frontend LoadBalancer: http://34.100.185.1/
+ echo üè• Backend (Internal): healthcare-backend-service:5002
üè• Backend (Internal): healthcare-backend-service:5002
+ echo üíæ Database (Internal): healthcare-mongodb-service:27017
üíæ Database (Internal): healthcare-mongodb-service:27017
+ echo ================================================
================================================
+ echo ‚úÖ 3-Tier Architecture with LoadBalancer Frontend!
‚úÖ 3-Tier Architecture with LoadBalancer Frontend!
+ echo ‚úÖ No CORS issues - Internal service communication!
‚úÖ No CORS issues - Internal service communication!
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Declarative: Post Actions)
[Pipeline] echo
Cleaning up...
[Pipeline] sh
+ docker system prune -f
Total reclaimed space: 0B
[Pipeline] echo
Pipeline completed successfully!
[Pipeline] script
[Pipeline] {
[Pipeline] sh
+ echo ==========================================
==========================================
+ echo üéâ 3-TIER ARCHITECTURE + MONITORING DEPLOYED
üéâ 3-TIER ARCHITECTURE + MONITORING DEPLOYED
+ echo ==========================================
==========================================
+ echo ‚úÖ Database Tier: MongoDB (healthcare-mongodb)
‚úÖ Database Tier: MongoDB (healthcare-mongodb)
+ echo ‚úÖ Backend Tier: Node.js API (healthcare-backend)
‚úÖ Backend Tier: Node.js API (healthcare-backend)
+ echo ‚úÖ Frontend Tier: React App (healthcare-frontend)
‚úÖ Frontend Tier: React App (healthcare-frontend)
+ echo ‚úÖ Monitoring: Prometheus + Grafana
‚úÖ Monitoring: Prometheus + Grafana
+ echo 

+ kubectl get service healthcare-frontend-service -n healthcare-app -o jsonpath={.status.loadBalancer.ingress[0].ip}
+ FRONTEND_IP=34.100.185.1
+ kubectl get service healthcare-backend-service -n healthcare-app -o jsonpath={.spec.clusterIP}
+ BACKEND_CLUSTER_IP=34.118.231.138
+ [ 34.100.185.1 != PENDING ]
+ [ 34.100.185.1 !=  ]
+ echo üåê Healthcare App: http://34.100.185.1/
üåê Healthcare App: http://34.100.185.1/
+ echo üè• Backend (Internal): 34.118.231.138:5002
üè• Backend (Internal): 34.118.231.138:5002
+ echo 

+ echo Complete 3-tier architecture with monitoring is now live!
Complete 3-tier architecture with monitoring is now live!
+ echo ==========================================
==========================================
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // node
[Pipeline] End of Pipeline
Finished: SUCCESS
